<div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in">

        <div class="bg-[#5c0a0a] p-6 flex justify-between items-center text-white">
            <div>
                <h2 class="text-xl font-serif-title font-bold">Ordem de Produ√ß√£o</h2>
                <p class="text-[#d4af37] text-sm">{{ product.name }} (SKU: {{ product.sku }})</p>
            </div>
            <button (click)="close.emit()" class="text-white/70 hover:text-white text-2xl">&times;</button>
        </div>

        <div class="p-6">

            <div class="flex items-center gap-4 mb-8 bg-[#f9f5f0] p-4 rounded-lg border border-[#d4af37]/30">
                <label class="font-bold text-gray-700">Quantidade a Produzir:</label>
                <div class="flex items-center">
                    <button (click)="updateQuantity(quantityToProduce() - 1)"
                            class="w-10 h-10 rounded-l border border-gray-300 bg-white hover:bg-gray-100 font-bold text-lg">-</button>

                    <input type="number"
                           [ngModel]="quantityToProduce()"
                           (ngModelChange)="updateQuantity($event)"
                           class="w-20 h-10 border-t border-b border-gray-300 text-center font-bold text-[#5c0a0a]" min="1">

                    <button (click)="updateQuantity(quantityToProduce() + 1)"
                            class="w-10 h-10 rounded-r border border-gray-300 bg-white hover:bg-gray-100 font-bold text-lg">+</button>
                </div>
            </div>

            <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">
                üìú Materiais Necess√°rios vs. Stock
            </h3>

            <div class="border rounded-lg overflow-hidden mb-6">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100 text-gray-600 uppercase text-xs font-bold">
                    <tr>
                        <th class="px-4 py-3">Material</th>
                        <th class="px-4 py-3 text-right">Necess√°rio</th>
                        <th class="px-4 py-3 text-right">Em Armaz√©m</th>
                        <th class="px-4 py-3 text-center">Estado</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                    @for (item of recipeStatus(); track item.materialId) {
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 font-medium text-gray-800">
                            {{ item.name }}
                        </td>

                        <td class="px-4 py-3 text-right font-bold text-[#5c0a0a]">
                            {{ item.required | number:'1.2-3' }} {{ item.unit }}
                        </td>

                        <td class="px-4 py-3 text-right text-gray-600">
                            {{ item.inStock | number:'1.2-3' }} {{ item.unit }}
                        </td>

                        <td class="px-4 py-3 text-center">
                            @if (item.hasEnough) {
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800">
                                            ‚úÖ OK
                                        </span>
                            } @else {
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800 animate-pulse">
                                            ‚ö†Ô∏è Falta
                                        </span>
                            }
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="4" class="p-4 text-center text-gray-500 italic">
                            Este produto n√£o tem receita configurada.
                        </td>
                    </tr>
                    }
                    </tbody>
                </table>
            </div>

            <div class="flex justify-end gap-3 pt-4 border-t border-gray-100">
                <button (click)="close.emit()"
                        class="px-5 py-2.5 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium transition">
                    Cancelar
                </button>

                <button (click)="onConfirm()"
                        [disabled]="!canProduce()"
                        [class.opacity-50]="!canProduce()"
                        [class.cursor-not-allowed]="!canProduce()"
                        class="px-5 py-2.5 rounded-md bg-[#5c0a0a] text-white hover:bg-[#3d0505] font-medium shadow-sm transition flex items-center gap-2">
                    @if (canProduce()) {
                    <span>üöÄ Confirmar Produ√ß√£o</span>
                    } @else {
                    <span>‚ö†Ô∏è Stock Insuficiente</span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>
