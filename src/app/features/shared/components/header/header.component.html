<nav class="bg-[#5c0a0a] sticky top-0 z-40 shadow-lg transition-all font-sans text-[#f9f5f0]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-20 items-center">

            <div class="flex-shrink-0 flex items-center">
                <a routerLink="/loja" class="text-2xl font-serif-title font-bold text-[#f9f5f0] tracking-wider hover:opacity-90 transition-opacity">
                    <span class="text-[#d4af37]">L</span>uz do Refúgio
                </a>
            </div>

            <div class="hidden md:block">
                <div class="ml-10 flex space-x-8 items-center">
                    <a routerLink="/loja"
                       routerLinkActive="text-[#d4af37]"
                       [routerLinkActiveOptions]="{exact: true}"
                       class="text-[#f9f5f0] hover:text-[#d4af37] px-3 py-2 rounded-md text-sm font-medium transition duration-300">
                        Home
                    </a>
                    <a routerLink="/loja/sobre"
                       routerLinkActive="text-[#d4af37]"
                       class="text-[#f9f5f0] hover:text-[#d4af37] px-3 py-2 rounded-md text-sm font-medium transition duration-300">
                        Sobre Nós
                    </a>
                    <a routerLink="/loja/contactos"
                       routerLinkActive="text-[#d4af37]"
                       class="text-[#f9f5f0] hover:text-[#d4af37] px-3 py-2 rounded-md text-sm font-medium transition duration-300">
                        Contactos
                    </a>
                    <button (click)="cart.toggleCart()" aria-label="Carrinho de compras" class="text-[#f9f5f0] hover:text-[#d4af37] p-2 rounded-md transition duration-300 relative group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        @if (cart.totalItemsCount() > 0) {
                        <span class="absolute -top-1 -right-1 bg-[var(--lumiere-gold)] text-[var(--lumiere-bordeaux)] text-[10px] font-bold rounded-full h-5 w-5 flex items-center justify-center border-2 border-[#5c0a0a] shadow-sm">
                                {{ cart.totalItemsCount() }}
                            </span>
                        }
                    </button>

                    @if (authService.currentUser(); as user) {
                    <a routerLink="/loja/minha-conta"
                       class="flex items-center gap-3 text-[#f9f5f0] hover:text-[#d4af37] transition-all group">

                        <div class="w-9 h-9 rounded-full bg-[#d4af37] text-[#5c0a0a] flex items-center justify-center font-bold text-lg border-2 border-transparent group-hover:border-[#f9f5f0] transition-all shadow-md">
                            {{ user.name ? user.name.charAt(0).toUpperCase() : 'U' }}
                        </div>

                        <div class="flex flex-col leading-tight">
                            <span class="text-[10px] opacity-70 uppercase tracking-wider">Minha Conta</span>
                            <span class="text-sm font-medium truncate max-w-[100px]">
                {{ user.name.split(' ')[0] }}
            </span>
                        </div>
                    </a>
                    } @else {
                    <a routerLink="/loja/login" class="text-[#f9f5f0] hover:text-[#d4af37] transition-colors p-2" title="Entrar / Registar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </a>
                    }
                </div>
            </div>

            <div class="-mr-2 flex md:hidden items-center gap-2">
                <button (click)="cart.toggleCart()" aria-label="Carrinho de compras" class="p-2 text-[#f9f5f0] relative">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    @if (cart.totalItemsCount() > 0) {
                    <span class="absolute top-0 right-0 bg-[var(--lumiere-gold)] text-[var(--lumiere-bordeaux)] text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center border border-[#5c0a0a]">
                            {{ cart.totalItemsCount() }}
                        </span>
                    }
                </button>
                <button (click)="toggleMobileMenu()" aria-label="Abrir menu" class="p-2 text-[#f9f5f0] hover:text-[#d4af37] focus:outline-none">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    @if (isMobileMenuOpen()) {
    <div class="md:hidden bg-[#4a0808] border-t border-white/5 animate-[fadeIn_0.2s]">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 text-[#f9f5f0]">
            <a routerLink="/loja" (click)="closeMobileMenu()"
               class="block px-3 py-2 rounded-md text-base font-medium text-[#f9f5f0] hover:text-[#d4af37] hover:bg-black/10">
                Home
            </a>
            <a routerLink="/loja/sobre" (click)="closeMobileMenu()"
               class="block px-3 py-2 rounded-md text-base font-medium text-[#f9f5f0] hover:text-[#d4af37] hover:bg-black/10">
                Sobre Nós
            </a>
            <a routerLink="/loja/contactos" (click)="closeMobileMenu()"
               class="block px-3 py-2 rounded-md text-base font-medium text-[#f9f5f0] hover:text-[#d4af37] hover:bg-black/10">
                Contactos
            </a>

            <div class="border-t border-white/10 my-2"></div>

            @if (authService.currentUser()) {
            <a routerLink="/loja/minha-conta" (click)="closeMobileMenu()" class="text-[#d4af37] font-bold block px-3 py-2 rounded-md text-base bg-black/20">
                Minha Conta
            </a>
            } @else {
            <a routerLink="/login" (click)="closeMobileMenu()" class="block px-3 py-2 rounded-md text-base font-medium text-[#f9f5f0] hover:text-[#d4af37]">
                Login / Registar
            </a>
            }
        </div>
    </div>
    }
</nav>
