@if (cartService.isCartOpen()) {
<div class="fixed inset-0 bg-black/50 z-[60] backdrop-blur-sm transition-opacity"
     (click)="cartService.toggleCart()">
</div>

<div class="fixed inset-y-0 right-0 max-w-md w-full bg-white shadow-2xl z-[70] flex flex-col transform transition-transform animate-[slideInRight_0.3s_ease-out]">

    <div class="p-6 bg-[var(--lumiere-cream)] border-b border-gray-100 flex justify-between items-center">
        <h2 class="text-xl font-serif-title text-[var(--lumiere-bordeaux)] font-bold">O Teu Carrinho</h2>
        <button (click)="cartService.toggleCart()" class="text-gray-400 hover:text-[var(--lumiere-bordeaux)]">
            <i data-feather="x" class="w-6 h-6"></i>
        </button>
    </div>

    <div class="flex-1 overflow-y-auto p-6 space-y-6">
        @if (cartService.cartItems().length === 0) {
        <div class="text-center py-10 opacity-60">
            <div class="text-4xl mb-4">üïØÔ∏è</div>
            <p>O carrinho est√° vazio.</p>
            <button (click)="cartService.toggleCart()" class="mt-4 text-[var(--lumiere-gold)] font-bold hover:underline">
                Ver Cole√ß√£o
            </button>
        </div>
        } @else {
        @for (item of cartService.cartItems(); track item.productId) {
        <div class="flex gap-4">
            <div class="w-20 h-20 bg-gray-100 rounded-md overflow-hidden flex-shrink-0">
                <img [src]="'/logo-velas/' + item.sku + '.webp'" [alt]="item.name" class="w-full h-full object-cover">
            </div>

            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <h3 class="font-bold text-[var(--lumiere-dark)]">{{ item.name }}</h3>
                    <button (click)="cartService.removeItem(item.productId)" class="text-gray-300 hover:text-red-500">
                        <i data-feather="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
                <p class="text-[var(--lumiere-gold)] font-medium text-sm">{{ item.price | currency:'EUR' }}</p>

                <div class="flex items-center mt-2 border border-gray-200 rounded-md w-max">
                    <button class="px-2 py-1 hover:bg-gray-100 text-gray-500 disabled:opacity-50 disabled:cursor-not-allowed"
                            [disabled]="item.quantity <= 1"
                            (click)="cartService.updateQuantity(item.productId, item.quantity - 1)">-</button>

                    <span class="px-2 text-sm font-medium">{{ item.quantity }}</span>

                    <button class="px-2 py-1 hover:bg-gray-100 text-gray-500 disabled:opacity-50 disabled:cursor-not-allowed"
                            [disabled]="item.quantity >= item.stock"
                            (click)="cartService.updateQuantity(item.productId, item.quantity + 1)">+</button>
                </div>
                @if (item.quantity >= item.stock) {
                    <span class="text-[10px] text-red-500 block mt-1">Stock m√°x. atingido</span>
                }
            </div>
        </div>
        }
        }
    </div>

    @if (cartService.cartItems().length > 0) {
    <div class="p-6 bg-gray-50 border-t border-gray-100">
        <div class="flex justify-between items-center mb-4">
            <span class="text-gray-500">Subtotal</span>
            <span class="text-xl font-bold text-[var(--lumiere-bordeaux)]">
            {{ cartService.subTotal() | currency:'EUR' }}
          </span>
        </div>
        <p class="text-xs text-gray-400 mb-4 text-center">Portes calculados no checkout.</p>

        <button class="w-full btn-gold text-[var(--lumiere-bordeaux)] py-3 font-bold rounded shadow-md"
                routerLink="/loja/checkout" (click)="cartService.toggleCart()">
            Finalizar Compra
        </button>
    </div>
    }
</div>
}
